@page "/onboarding"
@using WAAI.Features.UserOnboarding.Steps.Personal
@using WAAI.Features.UserOnboarding.Steps.Account
@using WAAI.Features.UserOnboarding.Steps.Preferences
@using WAAI.Features.UserOnboarding.Steps.Complete
@using WAAI.Core.Components
@using WAAI.Core.Models

<PageTitle>User Onboarding</PageTitle>

<div class="max-w-4xl mx-auto">
    <PageHeader Title="User Onboarding" />
    
    <StepWizard TStep="OnboardingStep" 
                CurrentStep="_currentStep" 
                CurrentStepChanged="OnStepChanged"
                Models="_models"
                OnComplete="Finish">
        <StepContent>
            @if (_currentStep == OnboardingStep.Personal)
            {
                <PersonalStep Model="_personalInfo" />
            }
            else if (_currentStep == OnboardingStep.Account)
            {
                <AccountStep Model="_accountInfo" />
            }
            else if (_currentStep == OnboardingStep.Preferences)
            {
                <PreferencesStep Model="_preferencesInfo" />
            }
            else if (_currentStep == OnboardingStep.Complete)
            {
                <CompleteStep Summary="CreateSummary()" />
            }
        </StepContent>
    </StepWizard>
</div>

@code {
    private OnboardingStep _currentStep = OnboardingStep.Personal;
    private readonly PersonalInfo _personalInfo = new();
    private readonly AccountInfo _accountInfo = new();
    private readonly PreferencesInfo _preferencesInfo = new();
    private readonly Dictionary<OnboardingStep, IStepModel> _models;

    public UserOnboarding()
    {
        _models = new()
        {
            [OnboardingStep.Personal] = _personalInfo,
            [OnboardingStep.Account] = _accountInfo,
            [OnboardingStep.Preferences] = _preferencesInfo
        };
    }

    private Task OnStepChanged(OnboardingStep newStep)
    {
        _currentStep = newStep;
        return Task.CompletedTask;
    }

    private void Finish() => _currentStep = OnboardingStep.Personal;

    private CompleteSummary CreateSummary() => new()
    {
        FullName = _personalInfo.FullName,
        Email = _personalInfo.Email,
        Username = _accountInfo.Username,
        Language = _preferencesInfo.Language,
        Theme = _preferencesInfo.Theme
    };
}
