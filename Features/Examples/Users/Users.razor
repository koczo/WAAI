@page "/users"
@using Blazored.LocalStorage
@using WAAI.Core.Models
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation

<PageTitle>Onboarded Users</PageTitle>

<div class="max-w-7xl mx-auto m-6">
    <h1 class="text-4xl font-bold mb-8">Onboarded Users</h1>

    @if (_users == null)
    {
        <div class="flex justify-center">
            <span class="loading loading-infinity loading-lg text-primary"></span>
        </div>
    }
    else if (!_users.Any())
    {
        <div class="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>No users have completed onboarding yet.</span>
        </div>
    }
    else
    {
        <div class="overflow-x-auto">
            <table class="table">
                <thead>
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Username</th>
                    <th>Language</th>
                    <th>Theme</th>
                    <th>Newsletter</th>
                    <th>Created At</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var user in _users)
                {
                    <tr class="hover">
                        <td>@user.FullName</td>
                        <td>@user.Email</td>
                        <td>@user.Phone</td>
                        <td>@user.Username</td>
                        <td>@user.Language</td>
                        <td>
                            <div class="badge badge-outline">@user.Theme</div>
                        </td>
                        <td>
                            @if (user.Newsletter)
                            {
                                <div class="badge badge-success">Yes</div>
                            }
                            else
                            {
                                <div class="badge badge-ghost">No</div>
                            }
                        </td>
                        <td>@user.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

        <div class="stats shadow mt-8">
            <div class="stat">
                <div class="stat-title">Total Users</div>
                <div class="stat-value">@_users.Count</div>
            </div>
        </div>
    }
</div>

<button class="btn btn-circle btn-primary fixed bottom-8 right-8 w-16 h-16"
        @onclick="@(() => Navigation.NavigateTo("/onboarding"))">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
</button>

@code {
    private List<User>? _users;

    protected override async Task OnInitializedAsync()
    {
        _users = await LocalStorage.GetItemAsync<List<User>>("users") ?? [];
    }

}
